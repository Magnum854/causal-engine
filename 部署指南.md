# 因果引擎部署指南

## 方案一：GitHub + 云平台部署（推荐）

### 第一步：上传到 GitHub

1. **初始化 Git 仓库**
```bash
cd "X:\因果引擎"
git init
git add .
git commit -m "Initial commit: 因果引擎项目"
```

2. **创建 GitHub 仓库**
   - 访问 https://github.com/new
   - 创建新仓库（可选择 public 或 private）
   - 不要初始化 README（因为本地已有）

3. **推送到 GitHub**
```bash
git remote add origin https://github.com/你的用户名/仓库名.git
git branch -M main
git push -u origin main
```

### 第二步：部署到公网

#### 选项 A：Railway（最简单，推荐新手）

1. 访问 https://railway.app
2. 使用 GitHub 账号登录
3. 点击 "New Project" → "Deploy from GitHub repo"
4. 选择你的因果引擎仓库
5. Railway 会自动检测 `docker-compose.yml` 并部署

**优点**：
- 免费额度：每月 $5 credit
- 自动 HTTPS
- 自动检测 Docker 配置
- 提供公网域名

#### 选项 B：Render（稳定可靠）

1. 访问 https://render.com
2. 注册并连接 GitHub
3. 创建 "New Web Service"
   - **Backend**: 选择 Docker，指向 `backend/Dockerfile`
   - **Frontend**: 选择 Static Site 或 Docker，指向 `frontend/Dockerfile`
4. 配置环境变量（见下方）

**优点**：
- 免费层可用
- 自动 SSL 证书
- 支持自定义域名

#### 选项 C：Vercel（前端）+ Railway/Render（后端）

**前端部署到 Vercel**：
1. 访问 https://vercel.com
2. Import Git Repository
3. 设置 Root Directory 为 `frontend`
4. 自动部署

**后端部署到 Railway/Render**（同上）

#### 选项 D：阿里云/腾讯云（国内访问快）

1. 购买云服务器（ECS/CVM）
2. 安装 Docker 和 Docker Compose
3. 克隆仓库并运行：
```bash
git clone https://github.com/你的用户名/仓库名.git
cd 仓库名
docker-compose up -d
```

### 第三步：配置环境变量

在部署平台添加以下环境变量：

```env
# API Keys
OPENAI_API_KEY=你的密钥
ANTHROPIC_API_KEY=你的密钥
TAVILY_API_KEY=你的密钥

# 数据库（如需要）
DATABASE_URL=postgresql://...

# 其他配置
BACKEND_URL=https://你的后端域名
FRONTEND_URL=https://你的前端域名
```

---

## 方案二：直接使用云服务器

### 适用场景
- 需要完全控制
- 已有云服务器
- 需要国内访问

### 部署步骤

1. **购买服务器**
   - 阿里云：https://www.aliyun.com/product/ecs
   - 腾讯云：https://cloud.tencent.com/product/cvm
   - AWS：https://aws.amazon.com/ec2/

2. **连接服务器**
```bash
ssh root@你的服务器IP
```

3. **安装依赖**
```bash
# 安装 Docker
curl -fsSL https://get.docker.com | sh
systemctl start docker
systemctl enable docker

# 安装 Docker Compose
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

4. **上传项目**
```bash
# 方法1：使用 Git
git clone https://github.com/你的用户名/仓库名.git
cd 仓库名

# 方法2：使用 SCP（从本地上传）
scp -r "X:\因果引擎" root@服务器IP:/root/
```

5. **配置环境变量**
```bash
nano .env
# 添加必要的环境变量
```

6. **启动服务**
```bash
docker-compose up -d
```

7. **配置防火墙**
```bash
# 开放端口
ufw allow 80
ufw allow 443
ufw allow 8000  # 后端端口
ufw allow 5173  # 前端端口（如需要）
```

8. **配置域名（可选）**
   - 在域名提供商处添加 A 记录指向服务器 IP
   - 使用 Nginx 反向代理
   - 配置 SSL 证书（Let's Encrypt）

---

## 方案三：使用 Ngrok（临时测试）

### 适用场景
- 快速展示
- 临时分享
- 不需要永久域名

### 步骤

1. **下载 Ngrok**
   - 访问 https://ngrok.com/download
   - 注册账号获取 authtoken

2. **本地启动项目**
```bash
cd "X:\因果引擎"
docker-compose up
```

3. **启动 Ngrok**
```bash
# 暴露后端
ngrok http 8000

# 暴露前端（新终端）
ngrok http 5173
```

4. **获取公网地址**
   - Ngrok 会提供临时的公网 URL
   - 例如：https://abc123.ngrok.io

**注意**：免费版每次重启 URL 会变化

---

## 推荐方案对比

| 方案 | 难度 | 成本 | 适用场景 |
|------|------|------|----------|
| Railway | ⭐ | 免费/$5月 | 快速部署，个人项目 |
| Render | ⭐⭐ | 免费起 | 稳定运行，小型项目 |
| Vercel+Railway | ⭐⭐ | 免费起 | 前后端分离 |
| 云服务器 | ⭐⭐⭐⭐ | ¥50+/月 | 完全控制，生产环境 |
| Ngrok | ⭐ | 免费 | 临时测试 |

---

## 下一步

选择一个方案后，我可以帮你：
1. 创建必要的配置文件
2. 编写部署脚本
3. 配置 CI/CD 自动部署
4. 设置域名和 SSL

请告诉我你想使用哪个方案？

